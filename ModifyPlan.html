<!DOCTYPE html>
<html lang="en">
<head>
  <title>Modify Plan</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
  <script src="./assets/js/handleState.js" type="text/javascript"></script>
  <script src="./bootstrap/js/jquery.min.js"></script>
  <script src="./bootstrap/js/bootstrap.bundle.js"></script>
  <link href="./fontawesome/css/all.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light" style="background-color: lightcoral;">
  <div class="container-fluid">
    <a class="navbar-brand" href="index.html">Hability</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav">
      <a class="nav-link" href="index.html">Home</a>
      <a class="nav-link" href="Calendar.html">Calendar</a>
      <a class="nav-link active" aria-current="page" href="ModifyPlan.html">Modify Plan</a>
      <a class="nav-link" href="WorkoutInfo.html">Workout Cheatsheet</a>
    </div>
    </div>
  </div>
</nav>
  
<div class="container" style="margin-bottom: 2%;">
  <div class="jumbotron text-center" style="margin-top: 2%; margin-bottom: 2%;">
    <h1>Modify Plan</h1>
  </div>
  <form id="modifyPlanForm">
    <div class="form-floating mb-3">
      <input type="text" class="form-control" id="nameInput" placeholder="CMSC434 Student" name="name" required>
      <label for="floatingInput">Name</label>
    </div>

    <div class="mb-3">
      <div>
        <label for="floatingInput">Sex</label>
      </div>
      <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
        <input type="radio" class="btn-check" name="sex" id="sexInputMale" autocomplete="off" value="male" required>
        <label class="btn btn-outline-dark" for="sexInputMale"><i class="fas fa-mars"></i>&nbsp;&nbsp;Male</label>
      
        <input type="radio" class="btn-check" name="sex" id="sexInputFemale" autocomplete="off" value="female">
        <label class="btn btn-outline-dark" for="sexInputFemale"><i class="fas fa-venus"></i>&nbsp;&nbsp;Female</label>
      </div>
    </div>

    <div class="form-floating mb-3">
      <input type="number" step="1" min="1" max="200" class="form-control" id="ageInput" placeholder="21" name="age" required>
      <label for="floatingInput">Age (in years)</label>
    </div>

    <div class="form-floating mb-3">
      <input type="number" step="1" min="1" max="1000" class="form-control" id="weightInput" placeholder="100" name="weight" required>
      <label for="floatingInput">Weight (in pounds)</label>
    </div>

    <div class="mb-3">
      <select class="form-select" aria-label="Select goal" id="goalInput" name="goal" onchange="preselectExercises();" required>
        <option value="" disabled selected>Select a Goal</option>
        <option value="lose-weight">Lose weight</option>
        <option value="build-muscles">Build muscles</option>
        <option value="improve-endurance">Improve endurance</option>
      </select>
    </div>

    <div class="mb-3">
      <div>
        <label for="floatingInput">Select Preferred Exercises</label>
      </div>
      <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
        <input type="checkbox" class="btn-check" name="preferredExercises" id="runInput" autocomplete="off" value="run">
        <label class="btn btn-outline-dark" for="runInput"><i class="fas fa-running"></i>&nbsp;&nbsp;Running</label>
      
        <input type="checkbox" class="btn-check" name="preferredExercises" id="walkInput" autocomplete="off" value="walk">
        <label class="btn btn-outline-dark" for="walkInput"><i class="fas fa-walking"></i>&nbsp;&nbsp;Walking</label>
      
        <input type="checkbox" class="btn-check" name="preferredExercises" id="bikeInput" autocomplete="off" value="bike">
        <label class="btn btn-outline-dark" for="bikeInput"><i class="fas fa-biking"></i>&nbsp;&nbsp;Biking</label>

        <input type="checkbox" class="btn-check" name="preferredExercises" id="swimInput" autocomplete="off" value="swim">
        <label class="btn btn-outline-dark" for="swimInput"><i class="fas fa-swimmer"></i>&nbsp;&nbsp;Swimming</label>
      
        <input type="checkbox" class="btn-check" name="preferredExercises" id="basketballInput" autocomplete="off" value="basketball">
        <label class="btn btn-outline-dark" for="basketballInput"><i class="fas fa-basketball-ball"></i>&nbsp;&nbsp;Basketball</label>
      
        <input type="checkbox" class="btn-check" name="preferredExercises" id="situpsInput" autocomplete="off" value="situps">
        <label class="btn btn-outline-dark" for="situpsInput">
          <i class="fas fa-pray"
          style="-webkit-transform:rotate(-110deg); -moz-transform: rotate(-110deg); -ms-transform: rotate(-110deg); -o-transform: rotate(-110deg); transform: rotate(-110deg);">
          </i>&nbsp;&nbsp;Situps
        </label>

        <input type="checkbox" class="btn-check" name="preferredExercises" id="dumbbellsInput" autocomplete="off" value="dumbbells">
        <label class="btn btn-outline-dark" for="dumbbellsInput"><i class="fas fa-dumbbell"></i>&nbsp;&nbsp;Dumbbells</label>
      </div>
      <div>
        <small id="exerciseInputHelp" class="form-text text-muted">See a list of Hability supported exercises <a href="./WorkoutInfo.html">here</a>.</small>
      </div>
    </div>

    <div class="mb-3">
      <div>
        <label for="floatingInput">Early Bird or Night Owl?</label>
      </div>
      <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
        <input type="radio" class="btn-check" name="dayOrNight" id="dayOrNightInputDay" autocomplete="off" value="day" required>
        <label class="btn btn-outline-dark" for="dayOrNightInputDay"><i class="fas fa-sun"></i>&nbsp;&nbsp;Early Bird</label>
      
        <input type="radio" class="btn-check" name="dayOrNight" id="dayOrNightInputNight" autocomplete="off" value="night">
        <label class="btn btn-outline-dark" for="dayOrNightInputNight"><i class="fas fa-moon"></i>&nbsp;&nbsp;Night Owl</label>
      </div>
    </div>

    <div class="form-floating mb-3">
      <input type="time" id="earliest_start" class="form-control" name="earliest_start" min="00:00" max="23:59" required>
      <label for="floatingInput">Earliest Possible Start Time</label>
    </div>

    <div class="form-floating mb-3">
      <input type="time" id="latest_start" class="form-control" name="latest_start" min="00:00" max="23:59" required>
      <label for="floatingInput">Latest Possible Start Time</label>
    </div>

    <div class="form-floating mb-3">
      <input type="number" step="1" min="1" max="60" class="form-control" id="durationInput" name="duration" placeholder="30" required>
      <label for="floatingInput">Exercise Duration (in minutes)</label>
    </div>
    
    <button type="submit" class="btn btn-primary">Modify Plan</button>
  </form>
</div>
</body>
<script>
  function preselectExercises() {
    $('input[type=checkbox]').prop('checked',false);
    let goal = document.getElementById("goalInput").value;
    if(goal === "lose-weight") {
      document.getElementById(`runInput`).checked = true;
      document.getElementById(`walkInput`).checked = true;
      document.getElementById(`bikeInput`).checked = true;
      document.getElementById(`swimInput`).checked = true;
    } else if(goal === "build-muscles") {
      document.getElementById(`situpsInput`).checked = true;
      document.getElementById(`dumbbellsInput`).checked = true;
    } else if(goal === "improve-endurance") {
      document.getElementById(`runInput`).checked = true;
      document.getElementById(`walkInput`).checked = true;
      document.getElementById(`bikeInput`).checked = true;
      document.getElementById(`swimInput`).checked = true;
      document.getElementById(`basketballInput`).checked = true;
    }
  }
  loadInitialState();
  if(localStorage.getItem("name") !== null) {
    document.getElementById("nameInput").value = localStorage.getItem("name");
  }
  if(localStorage.getItem("sex") !== null) {
    if(localStorage.getItem("sex") === "male") {
      document.getElementById("sexInputMale").checked = true;
    } else {
      document.getElementById("sexInputFemale").checked = true;
    }
  }
  if(localStorage.getItem("age") !== null) {
    document.getElementById("ageInput").value = localStorage.getItem("age");
  }
  if(localStorage.getItem("weight") !== null) {
    document.getElementById("weightInput").value = localStorage.getItem("weight");
  }
  if(localStorage.getItem("goal") !== null) {
    document.getElementById("goalInput").value = localStorage.getItem("goal");
  }
  if(localStorage.getItem("preferredExercises") !== null) {
    const preferredExercises = JSON.parse(localStorage.getItem("preferredExercises"));
    for(let index in preferredExercises) {
      document.getElementById(`${preferredExercises[index]}Input`).checked = true;
    }
  }
  if(localStorage.getItem("dayOrNight") !== null) {
    if(localStorage.getItem("dayOrNight") === "day") {
      document.getElementById("dayOrNightInputDay").checked = true;
    } else {
      document.getElementById("dayOrNightInputNight").checked = true;
    }
  }
  if(localStorage.getItem("earliest_start") !== null) {
    document.getElementById("earliest_start").value = localStorage.getItem("earliest_start");
  }
  if(localStorage.getItem("latest_start") !== null) {
    document.getElementById("latest_start").value = localStorage.getItem("latest_start");
  }
  if(localStorage.getItem("duration") !== null) {
    document.getElementById("durationInput").value = localStorage.getItem("duration");
  }
  $("#modifyPlanForm").submit((e) => {
    const preferredExercises = [];
    let regenerateWorkouts = false;
    const formData = new FormData(e.target);
    for(var pair of formData.entries()) {
      if(pair[0] === "preferredExercises"){
        preferredExercises.push(pair[1]);
      } else {
        if(pair[0] === "dayOrNight") {
          let currentDayOrNightValue = localStorage.getItem("dayOrNight");
          if(currentDayOrNightValue !== pair[1]) {
            regenerateWorkouts = true;
          }
        } else if (pair[0] === "earliest_start" || pair[0] === "latest_start" || pair[0] === "preferredExercises" || pair[0] === "duration"){
          regenerateWorkouts = true;
        }
        localStorage.setItem(pair[0], pair[1]);
      }
    }
    localStorage.setItem("preferredExercises", JSON.stringify(preferredExercises));
    if(regenerateWorkouts) {
      generateWorkouts(true);
    }
    window.location.href = "index.html";
    return false;
  });
</script>
</html>
